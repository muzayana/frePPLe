{% extends "admin/base_site_gridpivot.html" %}
{% load i18n %}

{% block extrahead %}{{block.super}} 
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.sparkline.min.js"></script>
{% endblock %}

{% block contextmenus %}
{% include "itemcontext.html" %}
{% include "forecastcontext.html" %}
{% include "customercontext.html" %}
<div id="detailcontext" class="ContextMenu"><ul class="ui-menu ui-widget ui-widget-content ui-corner-all ui-state-default">
<li class="ui-menu-item"><a id="{{request.prefix}}/demandplan/?demand__startswith={value}&amp;o=5a&amp;plandate__gte={startdate}&amp;plandate__lt={enddate}">{% trans 'Detail' %}</a></li>
</ul></div>
{% endblock %}

{% block tools %}{% if args.0 %}
{% include "forecasttabs.html" %}
{% endif %}{{block.super}}
{% endblock %}

{% block before_table %}
{% if args.0 %}<div id="chart1div" style="z-index: 1000;">
	  <p>&nbsp;</p>
	  <p>{% blocktrans %}frePPLe needs Adobe Flash Player to display graphs. If you're unable to see 
	  the chart here, it means that your browser does not seem to have the Flash Player 
	  installed.<br/>
	  You can downloaded it <a href="http://www.adobe.com/products/flashplayer/" target="_blank"><u>here</u></a> for free.{% endblocktrans %}</p>
	</div>
{% endif %}{% endblock %}

{% block crosses %}
function graph(cellvalue, options, rowdata) {
    var str = ['<span class="sparkline"><!--'];
    var cols = jQuery("#grid").jqGrid('getGridParam', 'colModel'); 
    var first = true; 
    for (var i in cols) {       
       if ('startdate' in cols[i]) {
          var data = rowdata[cols[i]['name']];
          if (first) {
            str.push(data[0]);
            first = false;
          }
          else
            str.push(',' + data[0]);
       }       
    }      
    str.push('--></span>');     
    return str.join('');
 };

function drawGraphs() {
  $('.sparkline').sparkline('html', { 
     type:'bar', disableHiddenCheck:true, chartRangeMin:0, 
     barColor:'#2B95EC', width:'100px', height:'60px' 
     });
};  

function getDirtyData()
{
  var changes = [];
  $(".dirty-cell").each( function() {
    var curCol = jQuery.jgrid.getCellIndex($(this).closest("td,th"));
    var curRow = $(this).closest("tr").attr('id');
    var colmodel = jQuery("#grid").jqGrid ('getGridParam', 'colModel')[curCol];
    changes.push({'id': curRow, 'startdate': colmodel['startdate'], 'enddate': colmodel['enddate'], 'value': $(this).val()});    
    });    
  return changes;
}
  
function onChange(event) 
{
  $(event.target).addClass('dirty-cell');
  upload.select();
}

function crosses (cellvalue, options, rowdata) {
{% if perms.input.change_forecastdemand %}
  var result = '<input type="text" class="smallpadding" value="' + Math.round(cellvalue[0]) + '" size="5" onchange="onChange(event)" onclick="$(this).select();"/><br/>' + Math.round(cellvalue[1]) + '<br/>' + Math.round(cellvalue[2]) + '<br/>';
{% else %}
  var result = Math.round(cellvalue[0]) + '<br/>' + Math.round(cellvalue[1]) + '<br/>' + Math.round(cellvalue[2]) + '<br/>';
{% endif %}
  if (cellvalue[3] != 0.0)
    result += Math.round(cellvalue[3]) + "<span class='context cross ui-icon ui-icon-triangle-1-e' role='detail'></span>";
  else
    result += '0.0';
  return result;
};
{% endblock %}

{% block extra_grid %}gridComplete: drawGraphs,
{% endblock %}