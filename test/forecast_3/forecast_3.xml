<?xml version="1.0" encoding="UTF-8" ?>
<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <name>Forecast test model</name>
  <description>
  This test verifies how actual orders consume from the forecast.
  It shows netting from earlier and later time buckets.
  </description>
  <current>2009-01-01T00:00:00</current>

  <!--
  This calendar defines how forecast values are disaggregated from the
  -->
  <calendars>
    <calendar name="planningbuckets">
      <buckets>
        <!--
          The value for saturday and sunday is set to zero.
          The forecast is only alllowed on weekdays.
        -->
        <!--
          The weight for a monday is higher than a friday.
          This can be used to model situations where more orders are
          expected to be shipped on monday than on fridays.
          Another usage may be to model cases where a peak of orders is
          expected for delivery near the end of a month.
          The weights model the ordering profile of the customers.
        -->
        <bucket start="2009-01-01T00:00:00" end="2009-01-02T00:00:00" value="1.2"/>
        <bucket start="2009-01-02T00:00:00" end="2009-01-03T00:00:00" value="1"/>
        <bucket start="2009-01-03T00:00:00" end="2009-01-04T00:00:00" value="1"/>
        <bucket start="2009-01-04T00:00:00" end="2009-01-05T00:00:00" value="1"/>
        <bucket start="2009-01-05T00:00:00" end="2009-01-06T00:00:00" value="0.8"/>
        <bucket start="2009-01-06T00:00:00" end="2009-01-07T00:00:00" value="0"/>
        <bucket start="2009-01-07T00:00:00" end="2009-01-08T00:00:00" value="0"/>
        <bucket start="2009-01-08T00:00:00" end="2009-01-09T00:00:00" value="1.2"/>
        <bucket start="2009-01-09T00:00:00" end="2009-01-10T00:00:00" value="1"/>
        <bucket start="2009-01-10T00:00:00" end="2009-01-11T00:00:00" value="1"/>
        <bucket start="2009-01-11T00:00:00" end="2009-01-12T00:00:00" value="1"/>
        <bucket start="2009-01-12T00:00:00" end="2009-01-13T00:00:00" value="0.8"/>
        <bucket start="2009-01-13T00:00:00" end="2009-01-14T00:00:00" value="0"/>
        <bucket start="2009-01-14T00:00:00" end="2009-01-15T00:00:00" value="0"/>
        <bucket start="2009-01-15T00:00:00" end="2009-01-16T00:00:00" value="1.2"/>
        <bucket start="2009-01-16T00:00:00" end="2009-01-17T00:00:00" value="1"/>
        <bucket start="2009-01-17T00:00:00" end="2009-01-18T00:00:00" value="1"/>
        <bucket start="2009-01-18T00:00:00" end="2009-01-19T00:00:00" value="1"/>
        <bucket start="2009-01-19T00:00:00" end="2009-01-20T00:00:00" value=".8"/>
        <bucket start="2009-01-20T00:00:00" end="2009-01-21T00:00:00" value="0"/>
        <bucket start="2009-01-21T00:00:00" end="2009-01-22T00:00:00" value="0"/>
        <!--
          The value of the weekly buckets is set to 5/7 to account for
          the unavailable saturday and sunday.
        -->
        <bucket start="2009-01-22T00:00:00" end="2009-01-29T00:00:00" value="0.7142857"/>
        <bucket start="2009-01-29T00:00:00" end="2009-02-05T00:00:00" value="0.7142857"/>
        <bucket start="2009-02-05T00:00:00" end="2009-02-12T00:00:00" value="0.7142857"/>
        <bucket start="2009-02-12T00:00:00" end="2009-02-19T00:00:00" value="0.7142857"/>
        <bucket start="2009-02-19T00:00:00" end="2009-02-26T00:00:00" value="0.7142857"/>
        <bucket start="2009-02-26T00:00:00" end="2009-03-05T00:00:00" value="0.7142857"/>
        <bucket start="2009-03-05T00:00:00" end="2009-03-12T00:00:00" value="0.7142857"/>
        <bucket start="2009-03-12T00:00:00" end="2009-03-19T00:00:00" value="0.7142857"/>
        <bucket start="2009-03-19T00:00:00" end="2009-03-26T00:00:00" value="0.7142857"/>
        <bucket start="2009-03-26T00:00:00" end="2009-04-02T00:00:00" value="0.7142857"/>
        <bucket start="2009-04-02T00:00:00" end="2009-04-09T00:00:00" value="0.7142857"/>
        <bucket start="2009-04-09T00:00:00" end="2009-04-16T00:00:00" value="0.7142857"/>
        <bucket start="2009-04-16T00:00:00" end="2009-04-23T00:00:00" value="0.7142857"/>
        <bucket start="2009-04-23T00:00:00" end="2009-04-30T00:00:00" value="0.7142857"/>
        <bucket start="2009-04-30T00:00:00" end="2009-05-07T00:00:00" value="0.7142857"/>
        <bucket start="2009-05-07T00:00:00" end="2009-05-14T00:00:00" value="0.7142857"/>
      </buckets>
    </calendar>
  </calendars>

  <items>
    <item name="Product 1">
      <operation name="delivery 1" xsi:type="operation_fixed_time">
        <duration>P1D</duration>
      </operation>
    </item>
  </items>

  <demands>
    <demand name="Forecast 1" xsi:type="demand_forecast">
      <item name="Product 1" />
      <priority>1</priority>
      <calendar name="planningbuckets" />
      <buckets>
        <bucket>
          <start>2009-01-01T00:00:00</start>
          <end>2009-01-29T00:00:00</end>
          <!-- 4 weeks with 5 working days per week, expecting an average
          forecast of 20 per working day. -->
          <total>400</total>
        </bucket>
      </buckets>
    </demand>
    <demand name="Order 1 for product 1">
       <item name="Product 1"/>
       <due>2009-01-03T00:00:00</due>
       <quantity>90</quantity>
       <priority>1</priority>
    </demand>
    <demand name="Order 2 for product 1">
       <item name="Product 1"/>
       <due>2009-01-03T00:00:00</due>
       <quantity>90</quantity>
       <priority>1</priority>
    </demand>
    <demand name="Order 3 for product 1">
       <item name="Product 1"/>
       <due>2009-01-27T00:00:00</due>
       <quantity>90</quantity>
       <priority>2</priority>
    </demand>
  </demands>

<?python
frepple.solver_forecast(name="Netting orders from forecast", loglevel=2).solve()
frepple.solver_mrp(name="MRP", plantype=2).solve()
frepple.saveXMLfile("output.1.xml")
frepple.saveplan("output.2.xml")
frepple.erase(True)
frepple.saveXMLfile("output.3.xml")
frepple.readXMLfile("output.1.xml")
frepple.solver_forecast(name="Netting orders from forecast", loglevel=2).solve()
frepple.saveXMLfile("output.4.xml")
?>

</plan>
